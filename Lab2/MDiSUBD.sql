-- LAB2 --
DROP TABLE STUDENTS;
DROP TABLE GROUPS;
-- TASK1 --
CREATE TABLE STUDENTS (
    ID NUMBER,
    NAME VARCHAR2(50) NOT NULL,
    GROUP_ID NOT NULL,
    
    CONSTRAINT student_id PRIMARY KEY (ID),
    CONSTRAINT fk_group FOREIGN KEY (GROUP_ID) REFERENCES GROUPS(ID) 
);

CREATE TABLE GROUPS (
    ID NUMBER,
    NAME VARCHAR2(50) NOT NULL,
    C_VAL NUMBER NOT NULL,
    
    CONSTRAINT group_pk PRIMARY KEY (ID)
);

-- TASK2 --
-- AUTOINCEMENT
CREATE SEQUENCE SEQ_GROUPS_ID
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE OR REPLACE TRIGGER AUTO_INCREMENT_GROUPS
BEFORE INSERT ON GROUPS
FOR EACH ROW
BEGIN
    SELECT SEQ_GROUPS_ID.NEXTVAL INTO :NEW.ID FROM DUAL;
END;

CREATE SEQUENCE SEQ_STUDENTS_ID
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE OR REPLACE TRIGGER AUTO_INCREMENT_STUDENTS
BEFORE INSERT ON STUDENTS
FOR EACH ROW
BEGIN
    SELECT SEQ_STUDENTS_ID.NEXTVAL INTO :NEW.ID FROM DUAL;
END;

-- UNIQUE
CREATE OR REPLACE TRIGGER CHECK_UNIQUE_GROUP_ID
BEFORE INSERT OR UPDATE ON GROUPS
FOR EACH ROW


    
INSERT INTO GROUPS (NAME, C_VAL) VALUES ('153503', 32);
SELECT * FROM GROUPS;